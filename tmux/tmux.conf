# =========================
#  초기 설정 및 터미널 옵션
# =========================

set-option -g default-terminal 'screen-256color'   # 기본 터미널 컬러 모드 설정
set-option -g terminal-overrides ',xterm-256color:RGB'  # RGB(TrueColor) 지원
# =========================
#  일반 환경 설정
# =========================

set -g prefix ^A                    # Prefix 키를 Ctrl+A로 변경 (기본은 Ctrl+B)
set -g base-index 1                 # 윈도우 번호를 1부터 시작
set -g detach-on-destroy off        # 세션 종료 시 자동으로 tmux 종료하지 않음
set -g escape-time 0                # ESC 키 입력 지연 시간 제거
set -g history-limit 1000000        # 스크롤 가능한 히스토리 라인 수 증가 (1,000,000)
set -g renumber-windows on          # 윈도우를 닫으면 번호 자동 재정렬
set -g set-clipboard on             # 시스템 클립보드 사용(macOS 클립보드와 연동)
set -g status-position top          # 상태바를 상단에 표시 (macOS 스타일)
set -g default-terminal "${TERM}"   # 현재 터미널 타입을 기본으로 설정
set -g mode-keys vi                # 복사모드 등에서 vi 키맵 사용
set -g mouse on
set -g default-shell "/bin/zsh"   # tmux 창 기본 셸을 zsh로 유지
set -s extended-keys on           # Ctrl/Shift/Alt 조합 키 신호 확장
set -as terminal-features 'xterm-ghostty:extkeys'  # Ghostty에서 확장 키 지원
set -g pane-active-border-style 'fg=magenta,bg=default'  # 활성 패널 테두리 색상
set -g pane-border-style 'fg=brightblack,bg=default'     # 비활성 패널 테두리 색상
# =========================
#  FZF 관련 플러그인 설정
# =========================
set -g @fzf-url-fzf-options '-p 60%,30% --prompt="   " --border-label=" Open URL "'
set -g @fzf-url-history-limit '2000'

# =========================
#  플러그인 로드 목록 (TPM)
# =========================

# 플러그인 관리기 (TPM: Tmux Plugin Manager)
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-yank'         # 시스템 클립보드 연동
set -g @plugin 'tmux-plugins/tmux-resurrect'    # 세션 복원
set -g @plugin 'tmux-plugins/tmux-continuum'    # 자동 저장 및 자동 복원
set -g @plugin 'fcsonline/tmux-thumbs'          # 터미널 내 텍스트 선택 보조
set -g @plugin 'sainnhe/tmux-fzf'               # FZF 기반 윈도우/세션 전환
set -g @plugin 'wfxr/tmux-fzf-url'              # FZF로 URL 선택 및 열기
set -g @plugin 'omerxx/catppuccin-tmux'         # Catppuccin 테마 (수정 버전)
set -g @plugin 'omerxx/tmux-sessionx'           # 세션 탐색기 (SessionX)
set -g @plugin 'omerxx/tmux-floax'              # 플로팅 창 플러그인

# =========================
#  Floax 설정 (플로팅 창)
# =========================
set -g @floax-width '80%'             # 플로팅 창 너비
set -g @floax-height '80%'            # 플로팅 창 높이
set -g @floax-border-color 'magenta'  # 테두리 색상
set -g @floax-text-color 'blue'       # 텍스트 색상
set -g @floax-bind 'p'                # 단축키: prefix + p 로 열기
set -g @floax-change-path 'true'      # 경로 자동 전환

# =========================
#  SessionX 설정 (세션 탐색기)
# =========================
set -g @sessionx-bind-zo-new-window 'ctrl-y'
set -g @sessionx-auto-accept 'off'
set -g @sessionx-bind 'o'
set -g @sessionx-window-height '85%'
set -g @sessionx-window-width '75%'
set -g @sessionx-zoxide-mode 'on'
set -g @sessionx-custom-paths-subdirectories 'false'
set -g @sessionx-filter-current 'false'

# =========================
#  자동 세션 복원 설정
# =========================
set -g @continuum-restore 'on'
set -g @resurrect-strategy-nvim 'session'

# =========================
#  Catppuccin 테마 설정
# =========================
set -g @catppuccin_window_left_separator ""
set -g @catppuccin_window_right_separator " "
set -g @catppuccin_window_middle_separator " █"
set -g @catppuccin_window_number_position "right"
set -g @catppuccin_window_default_fill "number"
set -g @catppuccin_window_default_text "#W"
set -g @catppuccin_window_current_fill "number"
set -g @catppuccin_window_current_text "#W#{?window_zoomed_flag,(),}"
set -g @catppuccin_status_modules_right "directory date_time"
set -g @catppuccin_status_modules_left "session"
set -g @catppuccin_status_left_separator  " "
set -g @catppuccin_status_right_separator " "
set -g @catppuccin_status_right_separator_inverse "no"
set -g @catppuccin_status_fill "icon"
set -g @catppuccin_status_connect_separator "no"
set -g @catppuccin_directory_text "#{b:pane_current_path}"
set -g @catppuccin_meetings_text "#($HOME/.config/tmux/scripts/cal.sh)"
set -g @catppuccin_date_time_text "%H:%M"

# =========================
#  Prefix 변경 (Ctrl+a)
# =========================
set -g prefix C-a       # Prefix를 Ctrl+a로 설정
unbind C-b              # 기본 Prefix(Ctrl+b) 해제
bind C-a send-prefix    # Ctrl+a 두 번 누르면 Prefix 신호 전달

# =========================
# 단축키
# =========================
bind h split-window -h  # 수평 분할
bind | split-window -h  # 수평 분할 (대체키)
bind v split-window -v  # 수직 분할
bind - split-window -v  # 수직 분할 (대체키)

# 줌 토글: f
unbind z
bind f resize-pane -Z

# 새 창: t
unbind c
bind t new-window

# 창이름 변경: r
bind r command-prompt "rename-window %%"

# 새세션 생성:n
bind n display-popup -E 'bash -i -c "read -p \"Session name: \" name; tmux new-session -d -s \$name && tmux switch-client -t \$name"'

#Yazi
bind e display-popup -E -w 80% -h 80% -x C -y C "yazi"

# Ctrl+숫자 → 해당 윈도우 이동
bind -n C-1 select-window -t 1
bind -n C-2 select-window -t 2
bind -n C-3 select-window -t 3
bind -n C-4 select-window -t 4
bind -n C-5 select-window -t 5
bind -n C-6 select-window -t 6
bind -n C-7 select-window -t 7
bind -n C-8 select-window -t 8
bind -n C-9 select-window -t 9

# =========================
#  TPM 실행
# =========================
run '~/.tmux/plugins/tpm/tpm'  # 플러그인 매니저(TPM) 실행
